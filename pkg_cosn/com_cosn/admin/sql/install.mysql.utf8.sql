CREATE TABLE IF NOT EXISTS `#__cosn` (
  `id` int(11) UNSIGNED NOT NULL AUTO_INCREMENT,
  `title` varchar(60) COLLATE utf8mb4_unicode_ci NOT NULL,
  `source` varchar(60) COLLATE utf8mb4_unicode_ci NOT NULL,
  `custom_code` text COLLATE utf8mb4_unicode_ci NULL,
  `access` tinyint(1) NOT NULL DEFAULT '0',
  `published` tinyint(1) NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=3 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

INSERT INTO `#__cosn` (`id`, `title`, `source`, `custom_code`, `access`, `published`) VALUES
(1, 'sudoku', 'components/com_cosn/demo/sudoku.php', '	<?php\n/**\n # cosnSudoku.php\n #\n # Run Sudoku app with Joomla\'s extension \"cosn\"\n #\n # @author Joachim Schmidt - joachim.schmidt@jschmidt-systemberatung.de\n # @copyright Copyright (C) 2021 Joachim Schmidt. All rights reserved.\n # @license	 http://www.gnu.org/licenses/gpl-2.0.html GNU/GPL\n # @formatter:off\n #\n # change activity:\n */\n    defined ( \'_JEXEC\' ) or die ( \'can only run under Joomla with extension &quot;cosn&quot;!\' );\n\n    use Joomla\\CMS\\Factory;\n    use Joomla\\CMS\\HTML\\HTMLHelper;\n    use Joomla\\CMS\\Uri\\Uri;\n    \n    HTMLHelper::_(\'jquery.framework\');\n    $base = JPATH_ROOT . \"/components/cosn/demo\";\n    $url = URI::root(true) . \"/index.php?option=com_ajax&plugin=cosn&group=system&format=raw&id=2\";\n\n    $document = Factory::getDocument ();\n    $document->addStylesheet( Uri::root(true) . \"/media/com_cosn/css/style.css\");\n    $document->addScript(  Uri::root(true) . \"/media/com_cosn/js/sudoku.min.js\");\n     \n    $text = parse_ini_file ($base . \"/sudoku.ini\", true );\n    $notes =  parse_ini_file ($base . \"/\" . $text[\'notes_ini\'], true);\n    $valid_languages = $text[\'languages\'];\n     \n    $lang = \"en\";\n    if (isset ($_REQUEST[\'lang\']))\n    {\n      $lang = $_REQUEST[\'lang\'];\n      if (strpos($valid_languages, $lang) === false)\n        $lang = \"en\";\n    }\n   \n    $text = $text[$lang];\n    $notes = $notes[$lang];\n      \n    if (isset ( $_REQUEST [\'sudoku\'] ) && is_numeric( $_REQUEST [\'sudoku\'] ))\n	   $parm = \"&sudoku=\" . intval ( $_REQUEST [\'sudoku\'] );\n	else\n	   $parm = \"&sudoku=noid\";\n	   \n	if (isset ( $_REQUEST [\'level\'] ) && is_numeric( $_REQUEST [\'level\'] ))\n	   $parm .= \"&level=\" . intval ( $_REQUEST [\'level\'] );\n	\n?>\n<div id=\"language\" style=\"display: none;\"><?php echo $lang; ?></div>\n<div id=\"sudoku-container\" class=\"sudoku-container\">\n<div class=\"bubble\">\n<div id=\"sudokuid\" class=\"rectangle\"><h2>Sudoku - </h2></div>\n<div class=\"triangle-l\"></div>\n<div class=\"triangle-r\"></div>\n<div class=\"sudoku-info\">\n<div id=\"sudoku\" class=\"center\">\n<div id=\'msgbox_content\' style=\'display: none\'><?php echo $text[\'success_msg\']; ?></div>\n<?php\n	$html = \"\\n<table class=\'sudoku\'>\";\n	$count = 0;\n	$check = \"onkeyup=\'checkValue($count, true, true)\'\";\n	for ($x = 0; $x < 9; $x++)\n	{\n		$html .= \"\\n<tr>\";\n		for ($y = 0; $y < 9; $y++)\n		{\n			$class = \"cell\";\n			if ($y == 2 || $y == 5)\n				$class = \"cell cell-right\";\n			\n			if ($x == 2 || $x == 5)\n				$class = \"cell cell-bottom\";\n			\n			if (($y == 2 && $x == 2) || ($y == 2 && $x == 5))\n				$class = \"cell cell-both\";\n			\n			if (($y == 5 && $x == 2) || ($y == 5 && $x == 5))\n				$class = \"cell cell-both\";\n\n			$check = \"onkeyup=\'checkValue($count, true, true)\'\";\n\n			$html .= \"\\n<td class=\'\" . $class . \"\'>\";\n			$html .= \"\\n <div id=\'candidates\" . $count . \"\' class=\'overlay\'></div>\";\n			$html .= \"\\n <input type=\'text\' id=\'i\" . $count . \"\' name=\'i\" . $count . \"\' \" .\n				  \"value=\'\' size=\'1\' maxlength=\'1\' class=\'cell\' $check />\\r\\n\";\n			$html .= \"</td>\";\n			$count ++;\n		}\n		$html .= \"</tr>\";\n	}\n	$html .= \"\\n</table>\";\n	echo $html;\n?>\n<br />\n<form id=\"form\" class=\"sudoku-form\" name=\"form\" action=\"none\">\n<input type=\"hidden\" name=\"sudoku\" value=\"\" />\n<input class=\"sudokubutton\" id=\"button1\"  type=\"button\" value=\"<?php echo $text[\'new_sudoku\']; ?>\" onclick=\"getPuzzle(\'<?php echo $url . \"\',\'null\"; ?>\')\" />\n<input class=\"sudokubutton\" id=\"button2\"  type=\"button\" value=\"<?php echo $text[\'solution\']; ?>\" onclick=\"showSolution()\" />\n<input class=\"sudokubutton\" id=\"button3\"  type=\"button\" value=\"<?php echo $text[\'print\']; ?>\" onclick=\"jQuery(\'#sudoku-container\').printElement()\" />\n<input type=\"checkbox\" id=\"help\" name=\"help\" value=\"0\" onclick=\"checkValues()\" />&nbsp;<?php echo $text[\'help\']; ?>&nbsp;\n<input type=\"checkbox\" id=\"check\" name=\"check\" value=\"1\" checked=\"checked\" onclick=\"checkValues()\" />&nbsp;<?php echo $text[\'check\']; ?>&nbsp;\n<br />\n<br />\n<b style=\"padding-left: 40px;\">Level:</b>&nbsp;\n<input type=\"radio\" id=\"level0\" name=\"level\" value=\"0\" checked=\"checked\" />&nbsp;<?php echo $text[\'level0\']; ?>&nbsp;\n<input type=\"radio\" id=\"level1\" name=\"level\" value=\"1\" />&nbsp;<?php echo $text[\'level1\']; ?>&nbsp;\n<input type=\"radio\" id=\"level2\" name=\"level\" value=\"2\" />&nbsp;<?php echo $text[\'level2\']; ?>&nbsp;\n</form>\n<div id=\"messages\" class=\"sudoku-messages\">&nbsp;</div>\n</div>\n\n<?php\n$script = \"\\njQuery(document).ready(function() {\";\n$script .= \"\\n   getPuzzle(\'\" .  $url . \"\',\'\" .$parm . \"\');\";\n$script .= \"\\n});\";\n\n$document->addCustomTag(\"<script type=\'text/javascript\'>\" . $script . \"</script>\");\necho \"<script type=\'text/javascript\' src=\'\" . $base . \"/print.js\'></script>\";\n?>\n\n</div>\n</div>\n</div>\n<div id=\"notes\">\n<?php echo $notes[\'notes\']; ?>\n</div>\n', 0, 1),
(2, 'sudoku_ajax', 'components/com_cosn/demo/sudoku_ajax.php', '<?php\r\n/**\r\n # sudoku_ajax.php\r\n #\r\n # Sudoku ajax backend:  responds to ajaxrequest and sends a sudoku puzzle\r\n #\r\n # @author Joachim Schmidt - joachim.schmidt@jschmidt-systemberatung.de\r\n # @copyright Copyright (C) 2014 Joachim Schmidt. All rights reserved.\r\n # @license	 http://www.gnu.org/licenses/gpl-2.0.html GNU/GPL\r\n #\r\n # change activity:\r\n */\r\ndefined ( \'_JEXEC\' ) or die ( \'can only run under Joomla with extension &quot;cosn&quot;!\' );\r\n\r\n$ini_file = JPATH_ROOT . \"/components/com_cosn/demo/sudoku.ini\";\r\n$settings = parse_ini_file($ini_file, true);\r\n\r\n$valid_languages = $settings[\'languages\'];\r\n\r\n$lang = \"en\";\r\nif (isset($_REQUEST[\'lang\'])) {\r\n    $lang = $_REQUEST[\'lang\'];\r\n    if (strpos($valid_languages, $lang) === false)\r\n        $lang = \"en\";\r\n}\r\n$text = $settings[$lang];\r\n\r\nif (isset($_REQUEST[\'level\']) && is_numeric($_REQUEST[\'level\']))\r\n    $level = $_REQUEST[\'level\'];\r\nelse\r\n    $level = \"0\";\r\n\r\n$puzzles = JPATH_ROOT. \"/components/com_cosn/demo/puzzles.l\" . $level;\r\n$max = getAnzSudokus($level, $puzzles);\r\n\r\n\r\nif (isset($_REQUEST[\'sudoku\']) && is_numeric($_REQUEST[\'sudoku\']))\r\n    $sudokuid = intval($_REQUEST[\'sudoku\']);\r\nelse\r\n    $sudokuid = rand(0, $max);\r\n\r\nif ($sudokuid < 0 || $sudokuid > $max)\r\n    $sudokuid = rand(0, $max);\r\n\r\necho getSudokuPuzzle($sudokuid, $level, $puzzles, $text);\r\nexit;\r\n\r\nfunction getSudokuPuzzle($sudokuid, $level, $puzzles, $text)\r\n{\r\n 	$result = array();\r\n    $string = \"level\" . $level;\r\n    $result[\'puzzle_id\'] = $sudokuid . \" (\" . $text[$string] . \")\";\r\n    $result[\'puzzle\'] = getSudoku($sudokuid, $puzzles);\r\n    return json_encode($result);\r\n    //return $result;\r\n}\r\n\r\nfunction getSudoku($line, $puzzles)\r\n{\r\n    $ls = 82;\r\n    \r\n    $size = filesize($puzzles);\r\n    $lines = $size / $ls;\r\n    if ($line > $lines) {\r\n        $line = $lines - 1;\r\n    }\r\n    \r\n    $handle = fopen($puzzles, \"r\");\r\n    $pos = $ls * $line;\r\n    fseek($handle, $pos, SEEK_SET);\r\n    $contents = fread($handle, $ls - 1);\r\n    fclose($handle);\r\n    return $contents;\r\n}\r\n\r\nfunction getAnzSudokus($level, $puzzles)\r\n{\r\n    $ls = 82;\r\n    $size = filesize($puzzles);\r\n    $lines = $size / $ls;\r\n    return intval($lines) - 1;\r\n}\r\n?>\n', 0, 1);


